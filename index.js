
// function main()
// {
//     size(400, 240)

//     var imageBase64 = "data:image/png;base64,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";
//     var img = loadPNGBase64(imageBase64, processing.externals.canvas, processing);

//     background(255, 255, 255);
//     image(img, 0, 0);
// }

// createProcessing(main);

function loadPNGBase64(base64, canvas, pjs)
{
    var ctx = canvas.getContext('2d');

    var png = loadBase64ImageData(base64.split(",")[1]);

    putImageData(ctx, {
        data: png.data,
        width: png.width,
        height: png.height
    }, 0, 0);

    var img = pjs.get(0, 0, png.width, png.height);

    return img;
}

function putImageData(ctx, imageData, dx, dy, dirtyX, dirtyY, dirtyWidth, dirtyHeight) 
{
    var data = imageData.data;
    var height = imageData.height;
    var width = imageData.width;

    dirtyX = dirtyX || 0;
    dirtyY = dirtyY || 0;
    dirtyWidth = dirtyWidth !== undefined ? dirtyWidth : width;
    dirtyHeight = dirtyHeight !== undefined ? dirtyHeight : height;

    var limitBottom = dirtyY + dirtyHeight;
    var limitRight = dirtyX + dirtyWidth;

    for (var y = dirtyY; y < limitBottom; y++) 
    {
        for (var x = dirtyX; x < limitRight; x++) 
        {
            var pos = y * width + x;
            ctx.fillStyle = 'rgba(' + data[pos * 4 + 0]
                            + ',' + data[pos * 4 + 1]
                            + ',' + data[pos * 4 + 2]
                            + ',' + (data[pos * 4 + 3] / 255) + ')';
            ctx.fillRect(x + dx, y + dy, 1, 1);
        }
    }
}